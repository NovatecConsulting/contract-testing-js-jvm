# Example project for the use of a js consumer and js provider with the Pact framework.

This project is a modified version of [DiUS Pact JS Workshop](https://github.com/DiUS/pact-workshop-js).
It has 2 components, a js consumer project and a js service provider.

Run the spec and see it all pass:

```
$ npm run test:consumer

> pact-js-js@1.0.0 test:pact:consumer /home/nt/Git/pact-js-js
> mocha consumer/test/consumerPact.spec.js



  Pact with Our Provider
    given data count > 0
      when a call to the Provider is made
        and a valid date is provided
          ✓ can process the JSON payload from the provider
          ✓ should validate the interactions and create a contract
        and an invalid date is provided
          ✓ can handle an invalid date parameter
          ✓ should validate the interactions and create a contract
        and no date is provided
          ✓ can handle missing date parameter
          ✓ should validate the interactions and create a contract
    given data count == 0
      when a call to the Provider is made
        and a valid date is provided
          ✓ can handle missing data
          ✓ should validate the interactions and create a contract


  8 passing (1s)
```

Use the created pact file to validate our assumptions on the provider side.

Generated pact file (*pacts/our_little_consumer-our_provider.json*):

```json
{
  "consumer": {
    "name": "Our Little Consumer"
  },
  "provider": {
    "name": "Our Provider"
  },
  "interactions": [
    {
      "description": "a request for JSON data",
      "providerState": "date count > 0",
      "request": {
        "method": "GET",
        "path": "/provider",
        "query": "validDate=2017-07-19T05%3A51%3A13.969Z"
      },
      "response": {
        "status": 200,
        "headers": {
          "Content-Type": "application/json; charset=utf-8"
        },
        "body": {
          "test": "NO",
          "validDate": "2013-08-15T15:31:20+02:00",
          "count": 100
        },
        "matchingRules": {
          "$.body.validDate": {
            "match": "regex",
            "regex": "\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\+\\d{2}:\\d{2}"
          },
          "$.body.count": {
            "match": "type"
          }
        }
      }
    },
    {
      "description": "a request with an invalid date parameter",
      "providerState": "date count > 0",
      "request": {
        "method": "GET",
        "path": "/provider",
        "query": "validDate=This+is+not+a+date"
      },
      "response": {
        "status": 400,
        "headers": {
          "Content-Type": "application/json; charset=utf-8"
        },
        "body": {
          "error": "'This is not a date' is not a date"
        }
      }
    },
    {
      "description": "a request with a missing date parameter",
      "providerState": "date count > 0",
      "request": {
        "method": "GET",
        "path": "/provider"
      },
      "response": {
        "status": 400,
        "headers": {
          "Content-Type": "application/json; charset=utf-8"
        },
        "body": {
          "error": "validDate is required"
        }
      }
    },
    {
      "description": "a request for JSON data",
      "providerState": "date count == 0",
      "request": {
        "method": "GET",
        "path": "/provider",
        "query": "validDate=2017-07-19T05%3A51%3A13.969Z"
      },
      "response": {
        "status": 404,
        "headers": {
          "Content-Type": "application/json; charset=utf-8"
        }
      }
    }
  ],
  "metadata": {
    "pactSpecification": {
      "version": "2.0.0"
    }
  }
}
```

# Step 4 - Verify the provider

To validate the pact generated by the consumer execute it against the provider:

```console
npm run test:pact:provider

> pact-js-js@1.0.0 test:pact:provider /home/nt/Git/pact-js-js
> mocha provider/test/providerPact.spec.js



Provider service listening on http://localhost:8081
  Pact Verification
Pact Verification Complete!
Reading pact at /home/nt/Git/pact-js-js/pacts/our_little_consumer-our_provider.json

Verifying a pact between Our Little Consumer and Our Provider
  Given date count > 0
    a request for JSON data
      with GET /provider?validDate=2017-07-19T06%3A47%3A11.958Z
        returns a response which
          has status code 200
          has a matching body
          includes headers
            "Content-Type" with value "application/json; charset=utf-8"
  Given date count > 0
    a request with an invalid date parameter
      with GET /provider?validDate=This+is+not+a+date
        returns a response which
          has status code 400
          has a matching body
          includes headers
            "Content-Type" with value "application/json; charset=utf-8"
  Given date count > 0
    a request with a missing date parameter
      with GET /provider
        returns a response which
          has status code 400
          has a matching body
          includes headers
            "Content-Type" with value "application/json; charset=utf-8"
  Given date count == 0
    a request for JSON data
      with GET /provider?validDate=2017-07-19T06%3A47%3A11.958Z
        returns a response which
          has status code 404
          includes headers
            "Content-Type" with value "application/json; charset=utf-8"

4 interactions, 0 failures



    ✓ should validate the expectations of Our Little Consumer (1108ms)


  1 passing (1s)
```
